# 装饰器模式 

> 什么是装饰器

原名decorator 被翻译为装饰器 可以理解为装饰 修饰 包装等意

## 现实中的现象
一间房子通过装饰可以变得更华丽，功能更多
 类似一部手机可以使用 但是很多人都愿意家个保护套来防摔。。。
## js中的现象
装饰器可以说是解决了不同类之间共享方法的问题（可以看做是弥补继承的不足）。

A Python decorator is a function that takes another function, extending the behavior of the latter function without explicitly modifying it.
这句话可以说是对装饰器的非常漂亮的解释。

在未来的 JavaScript 中也引入了这个概念，并且 babel 对他有很好的支持。如果你是一个疯狂的开发者，就可以借助 babel 大胆使用它。

## 工具准备

装饰器目前在浏览器或者 Node 中都暂时不支持，需要借助 babel 转化为可支持的版本

安装 babel

按照官网的 说明 安装：
```
npm install --save-dev babel-cli babel-preset-env
```
在 .babelrc 中写入：
```
{
  "presets": ["env"]
}
```
按照说明，安装 babel-plugin-transform-decorators-legacy 插件：
```
npm install babel-plugin-transform-decorators-legacy --save-dev 
```
.babelrc :
```
{
  "presets": ["env"],
  "plugins": ["transform-decorators-legacy"]
}
```
这样准备工作就完成了。

## 免环境的线上测试
> 代码直接放在 http://babeljs.io/repl/ 中运行查看结果，记得勾选Experimental选项和Evaluate选项

## 开始

先看看一个装饰器的写法

```
class Boy{
  @run
  speak (){
    console.log('I can speak')
  }
}
function run () {
  console.log('I can run')
}

let tj =  new Boy()
tj.speak()

// I can run 
// I can speak
```
@run 就是给类属性方法加的一个装饰器（其实也就是一个函数） 扩展了类Boy的speak(在讲话的同时跑步)

装饰器不仅可以装饰类的方法还可以装饰类（但是不可以装饰函数，因为函数存在变量提升）
装饰器函数接受3个参数 分别是装饰的对象，装饰的属性，装饰属性的描述
```
class Boy{
  @run
  speak (){
    console.log('I can speak')
  }
}
function run (target,key,descripter) {
  console.log(target,key,descripter)
}

let tj =  new Boy()
tj.speak()
// Boy {} 'speak' { value: [Function: speak],
  writable: true,
  enumerable: false,
  configurable: true }
I can speak
```

再来看一个例子
```
class Math {
  @log
  add(a, b) {
    return a + b
  }
}

function log(target, name, descriptor) {
  var oldValue = descriptor.value

  descriptor.value = function() {
    console.log(`Calling ${name} with`, arguments)
    return oldValue.apply(target, arguments)
  }

  return descriptor
}

const math = new Math()

// passed parameters should get logged now
math.add(2, 4)
// Calling add with { '0': 2, '1': 4 }
```

相当于在原来的add方法上扩展了一个console.log的功能，并没有改变原来的功能 (我们可以取到参数 就是可以改变他)

我们再来看一下





